<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->  
  <head>
    <title></title>

    <meta charset="utf-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Invalidating REDIS cache from Ruby - Random stuff</title>
    <meta name="description" content="Long time sysadmin with DevOpsy tendencies
">
    <meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="Invalidating REDIS cache from Ruby - Random stuff"><meta property="og:site_name" content="Random stuff"><meta property="og:description" content="Long time sysadmin with DevOpsy tendencies"><meta property="og:url" content="//leucos.github.io/2015/03/01/expiring-redis-cache-from-ruby/"><meta property="article:published_time" content="2015-03-01T00:00:00+01:00"><meta property="article:author" content="//leucos.github.io/about">
  
    

    

    <link rel="alternate" type="application/rss+xml" href="//leucos.github.io/feed.xml">
    <link rel="shortcut icon" href="//leucos.github.io/favicon.ico">
    <link rel="prefetch" href="//leucos.github.io">
    <link rel="canonical" href="//leucos.github.io/2015/03/01/expiring-redis-cache-from-ruby/">
    <link rel="stylesheet" 
    href="//leucos.github.io/assets/css/main.css">

    <link href='http://fonts.googleapis.com/css?family=Ubuntu:300,300italic'  rel='stylesheet' type='text/css'>
    <!-- IE Fixes -->
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <style type="text/css">a,.post-title a{color:#205081}a:hover{border-bottom-color:#205081}.sidebar{background-color:#205081}.wc-top,.sidebar-toggle:active,#sidebar-checkbox:checked ~ .sidebar-toggle{background-color:#205081}.sidebar a:hover,.sidebar .sidebar-nav a{border-bottom-color:#255d95}.sidebar .sidebar-nav{border-top-color:#255d95}.sidebar .sidebar-nav a.sidebar-nav-item:hover,.sidebar .sidebar-nav a.sidebar-nav-item:focus{background:#23588d}.sidebar .sidebar-nav .sidebar-nav-item.active{background-color:#1d4875}ul.social-media li>a{background-color:#1d4875;border-color:#255d95;border-bottom-color:#255d95 !important}ul.social-media li>a:hover{background-color:#b4d0ec}.btn{border-color:#205081;background:#205081}.btn:hover,.btn:focus{border-color:#1b436d;background:#1b436d}</style>
  </head>
  <body>
    <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"><div class="sidebar" id="sidebar">    <img     src="//leucos.github.io/assets/images/gravatar.jpg"    alt="Random stuff" />    <div class="sidebar-info">      <p>        Long time sysadmin with DevOpsy tendencies      </p>  </div>  <nav class="sidebar-nav">    <a class="sidebar-nav-item"       href="//leucos.github.io/">       Home    </a>                        <a class="sidebar-nav-item "       href="//leucos.github.io/about/ ">      About me    </a>                        <a class="sidebar-nav-item "       href="//leucos.github.io/archive/ ">      Blog Archive    </a>        <a class="sidebar-nav-item"       href="https://github.com/leucos"      target="_blank">      GitHub/Download    </a>  </nav>  <div class="sidebar-info small">     <p>       Copyright &copy; Michel Blanc - 2015       Powered by <a href="http://jekyllrb.com" target="_blank">Jekyll</a>       themed by <a href='https://github.com/gayanvirajith/gaya'>gaya</a>     </p>  </div>  <ul class="social-media">        <li>        <a title="b9m on Twitter"             href="https://twitter.com/b9m"             class="twitter wc-img-replace" target="_blank">Twitter</a>    </li>                       <li>        <a title="leucos on Github"             href="https://github.com/leucos"             class="github wc-img-replace" target="_blank">Github</a>    </li>                 <li>        <a title="Subscribe via RSS"             href="//leucos.github.io/feed.xml"            class="rss wc-img-replace" target="_blank">            RSS        </a>    </li></ul></div>

    <div class="main-wrapper">
      <div class="header">
        <div class="container">
          <div class="header-logo"><a href="//leucos.github.io/"   title="Random stuff">  <img     src="//leucos.github.io/assets/images/logo.png"    alt="Random stuff" /></a></div>
          <div class="header-title">
            <a href="//leucos.github.io/" 
              title="Random stuff"> 
              <h3>Random stuff<small>brain dump on sysadmin & DevOps related topics</small></h3>
            </a>
          </div>        
        </div>  
      </div>
      
      <div class="container content">
          <div class="post">

  

  

  <header class="post-header">
    <h1 class="post-title">Invalidating REDIS cache from Ruby</h1>
    <p class="post-meta">
    
    <span class="post-date">
    Mar 1, 2015  
    </span>
    </p>
  </header>

  <article class="post-content">
    <h2 id="redis-as-padrino-cache">REDIS as Padrino cache</h2>

<p>Using REDIS as and application cache is very handy. You can easily use
it in, say, <a href="http://www.padrinorb.com/">Padrino</a> like this:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">module</span> <span class="nn">MyApp</span>
  <span class="k">class</span> <span class="nc">App</span> <span class="o">&lt;</span> <span class="no">Padrino</span><span class="o">::</span><span class="no">Application</span>
    <span class="n">enable</span> <span class="ss">:caching</span>
    <span class="n">set</span> <span class="ss">:cache</span><span class="p">,</span> <span class="no">Padrino</span><span class="o">::</span><span class="no">Cache</span><span class="o">.</span><span class="n">new</span><span class="p">(</span> <span class="ss">:Redis</span><span class="p">,</span> 
                                    <span class="ss">:host</span> <span class="o">=&gt;</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;REDIS_SERVER&#39;</span><span class="o">]</span><span class="p">,</span>
                                    <span class="ss">:port</span> <span class="o">=&gt;</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;REDIS_PORT&#39;</span><span class="o">]</span><span class="p">,</span>
                                    <span class="ss">:db</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">MyApp</span><span class="o">::</span><span class="no">App</span><span class="o">.</span><span class="n">controllers</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">get</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:cache</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="k">do</span>
    <span class="n">cache_key</span> <span class="p">{</span> <span class="n">current_account</span><span class="o">.</span><span class="n">email</span> <span class="o">+</span> <span class="s2">&quot;:test:index&quot;</span> <span class="p">}</span>
    <span class="n">expires</span> <span class="mi">3600</span>
    <span class="vi">@title</span> <span class="o">=</span> <span class="s2">&quot;Some page with expensively computed values&quot;</span>
    <span class="n">render</span> <span class="s1">&#39;test/index&#39;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Note that we have a specific cache entry for each user
(<code>current_account.email</code>). For instance, a user with email <code>foo@bar.com</code>
will have this entry cached at <code>foo@bar.com:test:index</code></p>

<h2 id="cache-invalidation">Cache invalidation</h2>

<p>Now, sometimes you need to expire the cache forcibly. For instance,
let’s say you know you’ve changed something in the database and that you
don’t want stale data to be served, you can invalidate the cache
manually. Or may be you want to invalidate a complete user cache at
login time.</p>

<p>However, this is not easy in our case, since we want to remove all
entries matching <code>*:test:index</code> (or <code>foo@bar.com:*</code> if we want to
completely wipe out the user cache).</p>

<p>The first idea that comes to mind is to use the Redis <code>KEYS</code> command that can
accept globs to match key names, like <code>KEYS foo@bar.com:*</code>.</p>

<p>But in the documentation<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>, you’ll find a big fat warning about KEYS: </p>

<blockquote>
  <p>Warning: consider KEYS as a command that should only be used in production
environments with extreme care. It may ruin performance when it is executed
against large databases. This command is intended for debugging and special
operations, such as changing your keyspace layout. Don’t use KEYS in your
regular application code. If you’re looking for a way to find keys in a 
subset of your keyspace, consider using SCAN or sets.</p>
</blockquote>

<p>Scary as it sounds.</p>

<h2 id="cursors-to-the-rescue">Cursors to the rescue</h2>

<p>REDIS comes with a nice, but not very known feature since v2.8: SCAN. The SCAN
command is a cursor based iterator. You give him a key pattern, and every time
you call it, it will return the next set of matching keys, and an index for the
next call.</p>

<p>Here is a piece of code that can invalidate key wildcards from padrino :</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">MyApp</span><span class="o">::</span><span class="no">App</span><span class="o">.</span><span class="n">controllers</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">define_method</span> <span class="ss">:invalidate_cache_like</span> <span class="k">do</span> <span class="o">|</span><span class="n">wildcard</span><span class="o">|</span>
    <span class="n">r</span> <span class="o">=</span> <span class="no">Redis</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:host</span> <span class="o">=&gt;</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;REDIS_SERVER&#39;</span><span class="o">]</span><span class="p">,</span> <span class="ss">:port</span> <span class="o">=&gt;</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;REDIS_PORT&#39;</span><span class="o">]</span><span class="p">)</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="kp">nil</span>

    <span class="k">while</span> <span class="n">cursor</span> <span class="o">!=</span> <span class="s2">&quot;0&quot;</span> <span class="k">do</span>
      <span class="n">cursor</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">cursor</span><span class="o">||</span><span class="n">e</span><span class="p">,</span> <span class="p">{</span> <span class="ss">match</span><span class="p">:</span> <span class="n">wildcard</span><span class="p">})</span>

      <span class="n">keys</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">k</span><span class="o">|</span>
        <span class="n">r</span><span class="o">.</span><span class="n">del</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>You can not easily invalidate a cache wildcard calling
<code>invalidate_cache_like</code>. </p>

<p>For instance, at user login, you could call :</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="sb">`invalidate_cache_like &quot;</span><span class="si">#{</span><span class="n">current_account</span><span class="o">.</span><span class="n">email</span><span class="si">}</span><span class="sb">:test:index&quot;</span></code></pre></div>

<p>and the user cache is now cleared.</p>

<h2 id="benchmarking">Benchmarking</h2>

<p>Let’s play with <code>Benchmark</code> a bit to compare <code>SCAN</code> and <code>KEYS</code> performance on a
moderately sized database. While we’re at it, we’ll also check these commands using <code>redis</code> and <code>hiredis</code> drivers, to see if it makes any difference.</p>

<p>I used the following piece of code for that:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">#!/bin/env ruby</span>

<span class="nb">require</span> <span class="s1">&#39;hiredis&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;em-synchrony&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;redis&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;benchmark&#39;</span>

<span class="k">def</span> <span class="nf">build_cache</span><span class="p">(</span><span class="n">redis</span><span class="p">)</span>
  <span class="p">(</span><span class="s1">&#39;aaaa&#39;</span><span class="o">.</span><span class="n">.</span><span class="s1">&#39;zzzz&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
    <span class="n">redis</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">invalidate_cache_cursor</span><span class="p">(</span><span class="n">redis</span><span class="p">,</span> <span class="n">wildcard</span><span class="p">)</span>
  <span class="n">cursor</span> <span class="o">=</span> <span class="kp">nil</span>

  <span class="k">while</span> <span class="n">cursor</span> <span class="o">!=</span> <span class="s2">&quot;0&quot;</span> <span class="k">do</span>
    <span class="n">cursor</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">cursor</span><span class="o">||</span><span class="mi">0</span><span class="p">,</span> <span class="p">{</span> <span class="ss">match</span><span class="p">:</span> <span class="n">wildcard</span><span class="p">})</span>

    <span class="n">keys</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">k</span><span class="o">|</span>
      <span class="n">redis</span><span class="o">.</span><span class="n">del</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">invalidate_cache_keys</span><span class="p">(</span><span class="n">redis</span><span class="p">,</span> <span class="n">wildcard</span><span class="p">)</span>
  <span class="n">redis</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="n">wildcard</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">k</span><span class="o">|</span>
    <span class="n">redis</span><span class="o">.</span><span class="n">del</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">hiredis</span> <span class="o">=</span> <span class="no">Redis</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:driver</span> <span class="o">=&gt;</span> <span class="ss">:hiredis</span><span class="p">)</span>
<span class="n">redis</span> <span class="o">=</span> <span class="no">Redis</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>

<span class="no">Benchmark</span><span class="o">.</span><span class="n">bm</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span>
  <span class="o">[</span><span class="ss">:ruby</span><span class="p">,</span> <span class="ss">:hiredis</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">d</span><span class="o">|</span>
    <span class="n">r</span> <span class="o">=</span> <span class="no">Redis</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:driver</span> <span class="o">=&gt;</span> <span class="n">d</span><span class="p">)</span>
    <span class="n">build_cache</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">x</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;looping (</span><span class="si">#{</span><span class="n">d</span><span class="si">}</span><span class="s2">):&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="p">(</span><span class="s1">&#39;aaa&#39;</span><span class="o">.</span><span class="n">.</span><span class="s1">&#39;aaz&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">l</span><span class="o">|</span>
        <span class="n">invalidate_cache_keys</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">l</span><span class="si">}</span><span class="s2">*&quot;</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="p">}</span>
    <span class="n">build_cache</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="n">x</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;scanning (</span><span class="si">#{</span><span class="n">d</span><span class="si">}</span><span class="s2">):&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="p">(</span><span class="s1">&#39;aaa&#39;</span><span class="o">.</span><span class="n">.</span><span class="s1">&#39;aaz&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">l</span><span class="o">|</span>
        <span class="n">invalidate_cache_cursor</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">l</span><span class="si">}</span><span class="s2">*&quot;</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>After a few minutes running, I got those surprising results:</p>

<pre><code>$ ./redis-expire-wildcard.rb 
                            user     system      total        real
looping (ruby):          0.040000   0.010000   0.050000 (  1.059056)
scanning (ruby):        49.000000  11.490000  60.490000 ( 61.113561)
looping (hiredis):       0.020000   0.010000   0.030000 (  1.073681)
scanning (hiredis):     19.680000  12.880000  32.560000 ( 44.972220)
</code></pre>

<p>First, there is no much improvements using <code>hiredis</code> over <code>redis</code> when looping
in our case. This sounds legit, since we loop only 26 times here and the
<code>hiredis</code> performance benefit doesn’t rise with so few commands (<code>hiredis</code> does
a much more better job if you change the tested range so more commands are
issued).</p>

<p>Second, using <code>SCAN</code> here is <em>much</em> slower than using <code>KEYS</code> !</p>

<p>So why use <code>SCAN</code> instead of <code>KEYS</code> ? The problem with <code>KEYS</code> is that it will block your server while retrieving all the keys. The cursor based approach will return small chunks of keys and won’t block the server for the time of a whole key scan.</p>

<p>However, handling cursor based expiration can be tricky in a web application.
Since it takes so much longer (but is friendlier to Redis), you might have to
handle it in a separate task from your application process (in Sidekiq for instance).</p>

<p>It all depends on your app. You can start using simply <code>KEYS</code>, but will have to
keep in mind that cursors will be needed if usage or concurrent trafic rises and
monitor your Redis statistics for this.</p>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p><a href="http://redis.io/commands/KEYS">http://redis.io/commands/KEYS</a> <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>
    
  </article>

  
    <div class="related-posts">
      <h4>Related Posts</h4>
      <ul>
        
          <li>
            <h5>
              <a href="//leucos.github.io/decoupling-your-ansible-roles">
                Decoupling your Ansible roles
                <small>27 Jun 2015</small>
              </a>
            </h5>
          </li>
        
          <li>
            <h5>
              <a href="//leucos.github.io/2015/05/26/transparent-vault-revisited/">
                Transparent encryption with ansible vault revisited
                <small>26 May 2015</small>
              </a>
            </h5>
          </li>
        
          <li>
            <h5>
              <a href="//leucos.github.io/2015/05/25/ansible-transparent-vault/">
                Transparent encryption/decryption with ansible vault
                <small>25 May 2015</small>
              </a>
            </h5>
          </li>
        
      </ul>
    </div>
  

  <div class="author-info">
    
      <div class="author">   <a href="//leucos.github.io/about">    <img       src="//leucos.github.io/assets/images/gravatar.jpg"      alt="Random stuff" width="60" height="60" />  </a>    <h5>Author</h4>  <h6>    <a href="//leucos.github.io/about">      Michel blanc    </a>  </h5>  <p>    Find me on            <a title="b9m on Twitter"             href="https://twitter.com/b9m"             class="twitter" target="_blank">Twitter</a>        /         /      </p></div>
    
  
    
      <div class="share-buttons">  <h5>Share this post on</h5>  <ul class="social-media">    <li>        <a title="b9m on Twitter"           href="https://twitter.com/intent/tweet?original_referer=//leucos.github.io/2015/03/01/expiring-redis-cache-from-ruby/&amp;text=Invalidating REDIS cache from Ruby&amp;url=//leucos.github.io/2015/03/01/expiring-redis-cache-from-ruby/" class="twitter wc-img-replace" target="_blank">          Twitter        </a>    </li>       <li>        <a title=" on Google Plus"             href="https://plus.google.com/share?url=//leucos.github.io/2015/03/01/expiring-redis-cache-from-ruby/"             class="google wc-img-replace" target="_blank">Google</a>    </li>    <li>        <a title=" on Facebook"             href="https://www.facebook.com/sharer/sharer.php?u=//leucos.github.io/2015/03/01/expiring-redis-cache-from-ruby/&amp;t=Invalidating REDIS cache from Ruby"             class="facebook wc-img-replace" target="_blank">Facebook</a>    </li>  </ul></div>
      
  </div>
  
  
    <div class="comments">
        <a href="javascript:;" class="load-view">View Comments...</a>
        <div id="disqus_thread"></div>
        <div id="g-comments"></div>
    </div>
  
</div>

      </div>
      <a href="#0" class="wc-top">Top</a>
      
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle">
      <span></span>
    </label>

    <script type="text/javascript">
      var config = {
        "browser_warning_page": "//leucos.github.io/browser-warning/",
        "disqus_shortname": "randomstuffonrandomstuff"
      };
      /* Browser support detection */
      var browserSupport = (function(){
        var htmlElemClasses = document.querySelector('html').className.split(' ');
        for ( var i = 0; i < htmlElemClasses.length; i += 1 ){
          var className = htmlElemClasses[i];
          if ( className === 'lt-ie9' ){
            return true;
          }
        }
      }());

      if (browserSupport){
        window.location="//leucos.github.io/browser-warning/";
      }

      /* To avoid render blocking css */
      var cb = function() {
        var l = document.createElement('link'); l.rel = 'stylesheet';
        l.href = 'http://fonts.googleapis.com/css?family=PT+Sans';
        var h = document.getElementsByTagName('head')[0]; h.parentNode.insertBefore(l, h);
      };
      var raf = requestAnimationFrame || mozRequestAnimationFrame ||
          webkitRequestAnimationFrame || msRequestAnimationFrame;
      if (raf) raf(cb);
      else window.addEventListener('load', cb);


    </script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script async type="text/javascript" src="//leucos.github.io/assets/js/gaya.min.js"></script>
    
    
    
<script type="text/javascript">var _gaq = _gaq || [];_gaq.push(['_setAccount', 'UA-60810209-1']);_gaq.push(['_trackPageview']);(function() {var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);})();</script>
   
  </body>
</html>
